<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Papillon 1 ‚Äî Mobile</title>
<style>
  :root{--btn:#ff3b30; --ink:#111; --mut:#444; --line:#e9eaee}
  *{box-sizing:border-box}
  body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial;background:#000;color:#fff}
  /* HERO (mobile-first) */
  .hero{padding:20px 12px 24px;text-align:center}
  .hero img{width:100%;height:auto;border-radius:12px;display:block}
  .hero .enter{margin-top:14px;background:var(--btn);color:#fff;font-weight:800;border:none;border-radius:999px;padding:12px 20px;font-size:16px}
  .hero-copy{margin-top:12px}
  .hero-copy p{margin:0;color:#ddd;font-size:18px}
  .hero-copy h1{margin:6px 0 0;font-size:26px;line-height:1.2}
  /* MODAL */
  .modal{position:fixed;inset:0;display:none;align-items:flex-start;justify-content:center;background:rgba(0,0,0,.7);backdrop-filter:blur(2px);z-index:50}
  .modal.on{display:flex}
  .sheet{width:96vw;max-height:90vh;background:#fff;border:1px solid #e5e5e5;border-radius:12px;overflow:auto;box-shadow:0 20px 80px rgba(0,0,0,.45);margin-top:6vh}
  .slide{position:relative;width:100%;display:none;background:#fff;color:var(--ink)}
  .slide.on{display:block}
  .s1-wrap{padding:16px}
  .title1{margin:0 0 8px;font-size:24px;font-weight:900;text-align:center}
  .bullets{font-size:16px;line-height:1.5;margin:0 0 12px;padding:0 6px}
  .layout,.keysRow,.symbols,.symbols2,.emoji{display:block;width:100%;height:auto;margin:8px auto}
  .stepno{color:#777;font-size:12px;text-align:center;margin:8px 0 0}
  .frame{display:block;padding:16px}
  .keyIcon{width:96px;height:auto;display:block;margin:0 auto 8px}
  .hd{font-size:20px;font-weight:900;margin:0 0 6px;text-align:center}
  .sub{font-size:16px;margin:0 0 10px;text-align:center}
  .rule{display:grid;grid-template-columns:32px 1fr;gap:10px;border-top:1px solid var(--line);padding-top:10px}
  .check{width:28px;height:28px}
  .ruleText{font-size:15px;line-height:1.5;color:#111}
  .counter{color:#777;font-size:12px;text-align:center;margin:10px 0}
  .nav{position:sticky;bottom:0;display:flex;justify-content:space-between;align-items:center;gap:8px;padding:10px;border-top:1px solid #eee;background:#fafafa}
  .btn{border:1px solid #ddd;background:#fff;color:#111;padding:8px 12px;border-radius:10px;font-size:14px}
  .btn[disabled]{opacity:.5}
  .tryBig{display:block;background:var(--btn);color:#fff;border:none;border-radius:999px;padding:14px 0;font-size:18px;font-weight:800;box-shadow:0 10px 36px rgba(255,59,48,.28);cursor:pointer;width:100%;margin:14px 0 0}
  /* DEMO (mobile) */
  #demo{display:none;background:#000;color:#fff;padding:18px 12px 36px}
  .demoWrap{max-width:760px;margin:0 auto}
  .demoTop{display:flex;flex-direction:column;gap:8px;align-items:flex-start;margin-bottom:12px}
  .brand{font-size:24px;font-weight:900}
  .brand small{font-size:16px;font-weight:500;color:#cfcfcf;margin-left:6px}
  .surface{display:block}
  .padWrap{background:#1a2230;border:none;min-height:260px;padding:0;border-radius:8px;position:relative}
  #ppIO{width:100%;min-height:220px;border:none;background:#111a2b;color:#e9eef7;outline:none;padding:18px;margin:0;resize:vertical;font:22px/1.45 ui-monospace,Menlo,Consolas,monospace;border-radius:8px;text-align:center;font-weight:800;caret-color:#6ec1ff}
  /* Keyboard */
  #papillonDemo{--panel:#111a2b;--key:#22324a;--key-hover:#3b5188;--key-border:#2a3959;--txt:#e9eef7;--arrow:#6ec1ff;color:var(--txt);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Arial}
  #papillonDemo .board{background:var(--panel);border:1px solid var(--key-border);border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.35);padding:12px;margin-top:10px}
  #papillonDemo .row{display:flex;gap:6px;margin:6px 0;justify-content:center}
  #papillonDemo .key{position:relative;min-width:46px;height:52px;border-radius:10px;border:1px solid var(--key-border);background:var(--key);transition:background .08s ease, transform .08s}
  #papillonDemo .key.wide{min-width:60px}
  #papillonDemo .key.bs{min-width:88px}
  #papillonDemo .key.space{min-width:220px}
  /* ‚úÇÔ∏è ÎßàÏö∞Ïä§ Ìè¨Ïù∏ÌÑ∞ Í∞ïÏ†ú Ï†úÍ±∞(ÏÜê Î™®Ïñë ÏóÜÏùå) */
  /* (index.htmlÏùò cursor Í∞ïÏ†ú ÏßÄÏ†ï ÏóÜÏùå) */
  #papillonDemo .mark{position:absolute;line-height:1;font-weight:900;letter-spacing:.1px;pointer-events:none}
  #papillonDemo .mark.TL{top:6px;left:6px}
  #papillonDemo .mark.TR{top:6px;right:6px;text-align:right}
  #papillonDemo .mark.BL{bottom:6px;left:6px}
  #papillonDemo .mark.BR{bottom:6px;right:6px;text-align:right}
  #papillonDemo .alpha-big{font-size:22px}
  #papillonDemo .num{font-size:18px}
  #papillonDemo .sym{font-size:16px;opacity:.95}
  #papillonDemo .accent{color:#ff5555;font-weight:900;font-size:40px}
  /* Emoji Panel */
  #ppEmojiPanel{position:absolute;z-index:50;left:50%;transform:translateX(-50%);top:220px;background:#fff;border:1px solid rgba(255,255,255,.12);border-radius:12px;padding:12px;box-shadow:0 8px 26px rgba(0,0,0,.35);display:none;font-family:"Segoe UI Emoji","Apple Color Emoji","Noto Color Emoji",sans-serif}
  #ppEmojiPanel.show{display:block}
  #ppEmojiGrid{display:grid;grid-template-columns:repeat(8,40px);gap:6px;justify-items:center;align-items:center}
  #ppEmojiGrid .emojiBtn{border:0;background:none;width:28px;height:28px;font-size:24px;line-height:1;cursor:pointer;padding:0;border-radius:8px}
  /* Footer */
  .foot{background:#f2f0e6;color:#111;text-align:center;padding:24px 12px;font-size:16px}
</style>
</head>
<body>

<!-- HERO -->
<section class="hero">
  <img src="img/papillon.png" alt="Papillon">
  <div class="hero-copy">
    <p>Papa, maman ont l‚ÄôAZERTY.</p>
    <h1>Nous, on a le Papillon.</h1>
  </div>
  <button class="enter" id="heroBtn">En savoir plus</button>
</section>

<!-- TUTORIAL (Î™®Îã¨) -->
<div class="modal" id="modal">
  <div class="sheet">

    <div class="slide on" data-step="0">
      <div class="s1-wrap">
        <h1 class="title1">L‚Äôaccomplissement d‚ÄôAZERTY</h1>
        <div class="bullets">
          <div>‚Ä¢ Accents en un seul toucher, chiffres en un seul toucher.</div>
          <div>‚Ä¢ Symboles sans utiliser AltGr.</div>
        </div>
        <img class="layout" src="img/layout.png" alt="five triggers">
        <div class="stepno">1/10</div>
      </div>
    </div>

    <div class="slide" data-step="1">
      <div class="frame">
        <img class="keyIcon" src="img/comma.png" alt="comma trigger key">
        <h3 class="hd">Comment utiliser cette touche : <span style="color:red;">accent aigu</span></h3>
        <p class="sub"><span style="color:red;">,</span>+aeiouycnszrlwgkmp ‚Üí √°√©√≠√≥√∫√Ωƒá≈Ñ≈õ≈∫≈ïƒ∫·∫É«µ·∏±·∏ø·πï<br>Sinon, elle reste une virgule.</p>
        <div class="rule">
          <svg class="check" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="#10b981" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg>
          <div class="ruleText">
            Papillon 1 reconna√Æt ces lettres comme des accents lorsqu‚Äôelles suivent une virgule.<br>
            Comme on met toujours un espace apr√®s la virgule en tant que signe de ponctuation, il n‚Äôy a jamais de conflit entre les deux cas.
          </div>
        </div>
        <div class="counter">2/10</div>
      </div>
    </div>

    <div class="slide" data-step="2">
      <div class="frame">
        <img class="keyIcon" src="img/dot.png" alt="two dots trigger key">
        <h3 class="hd">Comment utiliser cette touche : <span style="color:red;">accent tr√©ma</span></h3>
        <p class="sub"><span style="color:red;">..</span>+aeiouy ‚Üí √§√´√Ø√∂√º√ø<br>Sinon, elle reste deux points.</p>
        <div class="rule">
          <svg class="check" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="#10b981" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg>
          <div class="ruleText">
            Quand vous tapez une ellipse avec deux points, vous ajoutez toujours une espace ensuite ‚Äî aucun conflit avec l‚Äôusage normal.
          </div>
        </div>
        <div class="counter">3/10</div>
      </div>
    </div>

    <div class="slide" data-step="3">
      <div class="frame">
        <img class="keyIcon" src="img/semicolon.png" alt="semicolon trigger key">
        <h3 class="hd">Comment utiliser cette touche : <span style="color:red;">accent circonflexe / c√©dille</span></h3>
        <p class="sub"><span style="color:red;">;</span>+aeiouy ‚Üí √¢√™√Æ√¥√ª≈∑<br><span style="color:red;">;</span>+cstgklnrdh ‚Üí √ß≈ü≈£ƒ£ƒ∑ƒº≈Ü≈ó·∏ë·∏©<br>Sinon, elle reste un point-virgule.</p>
        <div class="rule">
          <svg class="check" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="#10b981" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg>
          <div class="ruleText">
            On met toujours une espace apr√®s un point-virgule, donc pas de conflit avec la saisie d‚Äôaccent.
          </div>
        </div>
        <div class="counter">4/10</div>
      </div>
    </div>

    <div class="slide" data-step="4">
      <div class="frame">
        <img class="keyIcon" src="img/exclaim.png" alt="Grave & Tilde keys">
        <h3 class="hd">Comment utiliser cette touche : <span style="color:red;">accent grave / tilde</span></h3>
        <p class="sub"><span style="color:red;">!</span>+aeioun ‚Üí √†√®√¨√≤√π√±<br>Sinon, elle reste le symbole lui-m√™me.</p>
        <div class="rule">
          <svg class="check" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="#10b981" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg>
          <div class="ruleText">
            Les d√©veloppeurs peuvent activer l‚Äôoption d√©veloppeur pour √©viter tout conflit pendant la programmation.
          </div>
        </div>
        <div class="counter">5/10</div>
      </div>
    </div>

    <div class="slide" data-step="5">
      <div class="frame">
        <img class="keyIcon" src="img/q.png" alt="q ligature key">
        <h3 class="hd">Comment utiliser cette touche : <span style="color:red;">ligatures</span></h3>
        <p class="sub"><span style="color:red;">q</span>+a/o ‚Üí √¶/≈ì ‚Äî sinon, elle reste q.</p>
        <div class="rule">
          <svg class="check" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="#10b981" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg>
          <div class="ruleText">
            On trouve toujours un u apr√®s q ‚Äî Papillon 1 ne touche jamais √† qu.
          </div>
        </div>
        <div class="counter">6/10</div>
      </div>
    </div>

    <div class="slide" data-step="6">
      <div class="frame">
        <img class="keyIcon" src="img/2.png" alt="digits">
        <h3 class="hd">Des chiffres et des symboles plus pratiques</h3>
        <p class="sub">Les chiffres sans Majuscule, plus ¬´ ¬ª ‚Äì ‚Äî ‚Ä¢</p>
        <div class="rule">
          <svg class="check" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="#10b981" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg>
          <div class="ruleText">Tapez d√©sormais les chiffres sans Majuscule m√™me sur votre AZERTY.</div>
        </div>
        <div class="counter">7/10</div>
      </div>
      <img class="layout" src="img/numkey.png" alt="numbers">
    </div>

    <div class="slide" data-step="7">
      <div class="frame">
        <img class="keyIcon" src="img/dev.png" alt="developer key">
        <h3 class="hd">Caract√®res sp√©ciaux m√©morisables</h3>
        <p class="sub">Fl√®che puis symbole ‚Äî alias par initiale.<br/>Double appui pour afficher la carte.</p>
        <div class="rule">
          <svg class="check" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="#10b981" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg>
          <div class="ruleText">Tapez des symboles sans AltGr.</div>
        </div>
        <div class="counter">8/10</div>
      </div>
      <img class="symbols" src="img/symbols.png" alt="symbols">
    </div>

    <div class="slide" data-step="8">
      <div class="frame">
        <img class="keyIcon" src="img/emoji.png" alt="emoji">
        <h3 class="hd">Touche emoji</h3>
        <p class="sub">Appuyez sur üòÄ pour ouvrir le panneau.</p>
        <div class="rule">
          <svg class="check" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="#10b981" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg>
          <div class="ruleText">Exprimez-vous avec des emojis.</div>
        </div>
        <div class="counter">9/10</div>
      </div>
      <img class="emoji" src="img/emoji2.png" alt="emoji panel">
    </div>

    <div class="slide" data-step="9">
      <div class="frame">
        <img class="keyIcon" src="img/tip.png" alt="dev tip">
        <h3 class="hd">Astuce pour les d√©veloppeurs</h3>
        <p class="sub">Q. Papillon 1 pose-t-il des probl√®mes pendant le codage ?<br/>
        A. Pas d‚Äôinqui√©tude.</p>
        <div class="rule">
          <svg class="check" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path fill="#10b981" d="M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4z"/></svg>
          <div class="ruleText">
            Laissez toujours une espace apr√®s les virgules et les points-virgules, comme vous le feriez normalement.
          </div>
        </div>
        <div class="counter">10/10</div>
        <button class="tryBig" id="tryBig">Essayez maintenant</button>
      </div>
    </div>

    <div class="nav">
      <button id="prev" class="btn" disabled>Pr√©c√©dent</button>
      <div class="dots" id="dots" style="display:flex;gap:6px"></div>
      <div>
        <button id="close" class="btn" style="margin-right:8px">Fermer</button>
        <button id="next" class="btn">Suivant</button>
      </div>
    </div>

  </div>
</div>

<!-- DEMO -->
<section id="demo" class="demoNotice">
  <div style="text-align:center;padding:60px 20px;font-size:18px;color:#ccc;">üíª Veuillez visiter ce site sur un ordinateur pour essayer le clavier Papillon.</div>
</section>

<!-- Footer -->
<section class="foot">
  <div>Logiciel d‚Äôam√©lioration de l‚ÄôAZERTY.</div>
  <div style="margin-top:6px;font-size:20px;">Bient√¥t disponible.</div>
</section>

<!-- SCRIPTS: modal + demo -->
<script>
// Modal & navigation
const heroBtn=document.getElementById('heroBtn');
const modal=document.getElementById('modal');
const slides=[...document.querySelectorAll('.slide')];
const prev=document.getElementById('prev');
const next=document.getElementById('next');
const closeBtn=document.getElementById('close');
const dots=document.getElementById('dots');
const tryBig=document.getElementById('tryBig');
const demo=document.getElementById('demo');

function openModal(){document.body.style.overflow='hidden';modal.classList.add('on');show(0);}
function closeModal(){modal.classList.remove('on');document.body.style.overflow='';}
function openDemo(){closeModal();demo.style.display='block';window.scrollTo({top:demo.offsetTop,behavior:'smooth'});localStorage.setItem('uq_seen_tutorial','1');}

heroBtn.addEventListener('click',openModal);

document.addEventListener('keydown', (e) => {
  const tag=(e.target?.tagName||'').toLowerCase();
  const isEditable=e.target?.isContentEditable||tag==='textarea'||tag==='input'||tag==='select';
  if(isEditable) return;
  if(modal.classList.contains('on')){
    if(e.key==='Enter'){e.preventDefault(); if(i<slides.length-1) show(i+1); else openDemo();}
    if(e.key==='ArrowLeft'){e.preventDefault(); show(i-1);}
    if(e.key==='ArrowRight'){e.preventDefault(); if(i<slides.length-1) show(i+1); else openDemo();}
    if(e.key==='Escape'){e.preventDefault(); closeModal();}
  }
});

if(tryBig) tryBig.addEventListener('click',openDemo);

let i=0;
function renderDots(){dots.innerHTML=''; for(let k=0;k<slides.length;k++){const d=document.createElement('div');d.style.width='7px';d.style.height='7px';d.style.borderRadius='50%';d.style.background=k===i?'#111':'#ddd';dots.appendChild(d);}}
function show(n){i=Math.max(0,Math.min(slides.length-1,n));slides.forEach((el,idx)=>el.classList.toggle('on',idx===i));prev.disabled=(i===0);next.disabled=(i===slides.length-1);renderDots();}
prev.addEventListener('click',()=>show(i-1));
next.addEventListener('click',()=>show(i+1));
closeBtn.addEventListener('click',closeModal);

// Ï≤´ Î∞©Î¨∏ Ïãú Î∞îÎ°ú ÌäúÌÜ†Î¶¨Ïñº Ïó¥ÏßÄ Ïó¨Î∂Ä (Î™®Î∞îÏùºÏùÄ Î≤ÑÌäºÏúºÎ°ú Ïó¥Í∏∞ Ïú†ÏßÄ)
</script>

<script>
// Papillon Demo (Î™®Î∞îÏùº) ‚Äî indexÏùò Î°úÏßÅÏùÑ Î™®Î∞îÏùºÏóê ÎßûÍ≤å Ï∂ïÏïΩ/ÎèôÏùº Ïú†ÏßÄ
(function () {
  const io = document.getElementById('ppIO');
  if (!io) return;

  let shift = false;
  let emojiOpen = false;

  const $panel = document.getElementById('ppEmojiPanel');
  const $grid  = document.getElementById('ppEmojiGrid');

  const EMOJIS = Array.from('üòÄüòÅüòÇü§£üòÉüòÑüòÖüòâüòäüòçüòòüòúü§îü§óü§©ü•≥üòéüò≠üò°üß°üíîüí¢üí¶üëçüôè‚ú®üî•üíØ‚úÖ‚ùåüåüüéâüéÅüìåüçî‚òïüöó‚úàüè°üè¨‚Äª¬©¬Æ‚Ñ¢üëàüëâüëÜüëá');

  function buildEmojiGrid(){
    if (!$grid || $grid.childElementCount) return;
    EMOJIS.forEach((em)=>{
      const btn = document.createElement('button');
      btn.className = 'emojiBtn';
      btn.type = 'button';
      btn.textContent = em;
      btn.addEventListener('click', ()=>{
        let v = io.value;
        const s = io.selectionStart, e = io.selectionEnd;
        const last = v.lastIndexOf('üôÇ');
        if (last !== -1){
          v = v.slice(0, last) + em + v.slice(last + 2);
          io.value = v;
          const caret = last + em.length;
          io.selectionStart = io.selectionEnd = caret;
        } else {
          io.value = v.slice(0, s) + em + v.slice(e);
          const caret = s + em.length;
          io.selectionStart = io.selectionEnd = caret;
        }
        closeEmojiPanel(); io.focus();
      });
      $grid.appendChild(btn);
    });
  }
  function openEmojiPanel(){ if(!$panel) return; buildEmojiGrid(); $panel.classList.add('show'); $panel.setAttribute('aria-hidden','false'); emojiOpen = true; }
  function closeEmojiPanel(){ if(!$panel) return; $panel.classList.remove('show'); $panel.setAttribute('aria-hidden','true'); emojiOpen = false; }
  document.addEventListener('keydown', ()=>{ if (emojiOpen) closeEmojiPanel(); }, {passive:true});
  // Close emoji when tapping outside
  document.addEventListener('click', (e)=>{
    if (emojiOpen && !e.target.closest('#ppEmojiPanel') && !e.target.closest('#emojiKey')){
      closeEmojiPanel();
    }
  }, {capture:true});


  const mapDev = { a:'@', e:'‚Ç¨', t:'~', p:'|', s:'[', d:']', h:'#', c:'{', v:'}', b:'\\', l:'<', m:'>', ';':'^', '!':'`', '.':'¬∑' };
  const mapLigE = { 'o':'≈ì','O':'≈í', 'a':'√¶','A':'√Ü' };
  const mapAcute = {'a':'√°','e':'√©','i':'√≠','o':'√≥','u':'√∫','y':'√Ω','A':'√Å','E':'√â','I':'√ç','O':'√ì','U':'√ö','Y':'√ù','c':'ƒá','C':'ƒÜ','n':'≈Ñ','N':'≈É','s':'≈õ','S':'≈ö','z':'≈∫','Z':'≈π','r':'≈ï','R':'≈î','l':'ƒ∫','L':'ƒπ','w':'·∫É','W':'·∫Ç','g':'«µ','G':'«¥','k':'·∏±','K':'·∏∞','m':'·∏ø','M':'·∏æ','p':'·πï','P':'·πî'};
  const mapGrave = {'a':'√†','e':'√®','i':'√¨','o':'√≤','u':'√π','A':'√Ä','E':'√à','I':'√å','O':'√í','U':'√ô'};
  const mapCirc  = {'a':'√¢','e':'√™','i':'√Æ','o':'√¥','u':'√ª','y':'≈∑','A':'√Ç','E':'√ä','I':'√é','O':'√î','U':'√õ','Y':'≈∂'};
  const maptrema = {'a':'√§','e':'√´','i':'√Ø','o':'√∂','u':'√º','y':'√ø','A':'√Ñ','E':'√ã','I':'√è','O':'√ñ','U':'√ú','Y':'≈∏'};
  const mapcedil = {'c':'√ß','C':'√á','s':'≈ü','S':'≈û','t':'≈£','T':'≈¢','g':'ƒ£','G':'ƒ¢','k':'ƒ∑','K':'ƒ∂','l':'ƒº','L':'ƒª','n':'≈Ü','N':'≈Ö','r':'≈ó','R':'≈ñ','d':'·∏ë','D':'·∏ê','h':'·∏©','H':'·∏®'};
  const mapTilde = {'a':'√£','A':'√É','o':'√µ','O':'√ï','e':'·∫Ω','E':'·∫º','i':'ƒ©','I':'ƒ®','u':'≈©','U':'≈®','n':'√±','N':'√ë'};

  function insert(text){
    const s = io.selectionStart, e = io.selectionEnd, v = io.value;

    if (s === e && s > 0 && v[s-1] === '‚Üí' && text.length === 1 && mapDev[text] !== undefined){
      io.value = v.slice(0, s-1) + mapDev[text] + v.slice(e);
      const caret = (s - 1) + 1; io.selectionStart = io.selectionEnd = caret; io.focus(); return;
    }
    if (s === e && s > 0 && (v[s-1] === 'q' || v[s-1] === 'Q') && text.length === 1 && mapLigE[text]){
      io.value = v.slice(0, s-1) + mapLigE[text] + v.slice(e);
      const caret = (s - 1) + 1; io.selectionStart = io.selectionEnd = caret; io.focus(); return;
    }
    if (s === e && s > 0 && v[s-1] === ',' && text.length === 1 && mapAcute[text]){
      io.value = v.slice(0, s-1) + mapAcute[text] + v.slice(e);
      const caret = (s - 1) + 1; io.selectionStart = io.selectionEnd = caret; io.focus(); return;
    }
    if (s === e && s > 0 && v[s-1] === ';' && text.length === 1){
      let mapped = null;
      if (mapCirc[text]) mapped = mapCirc[text];
      else if (mapcedil[text]) mapped = mapcedil[text];
      if (mapped){
        io.value = v.slice(0, s-1) + mapped + v.slice(e);
        const caret = (s - 1) + 1; io.selectionStart = io.selectionEnd = caret; io.focus(); return;
      }
    }
    if (s === e && s > 1 && v.slice(s-2, s) === '..' && text.length === 1 && maptrema[text]){
      io.value = v.slice(0, s-2) + maptrema[text] + v.slice(e);
      const caret = (s - 2) + 1; io.selectionStart = io.selectionEnd = caret; io.focus(); return;
    }
    if (s === e && s > 1 && v.slice(s-2, s) === '!!' && text.length === 1 && mapTilde[text]){
      io.value = v.slice(0, s-2) + mapTilde[text] + v.slice(e);
      const caret = (s - 2) + 1; io.selectionStart = io.selectionEnd = caret; io.focus(); return;
    }
    if (s === e && s > 0 && v[s-1] === '!' && text.length === 1){
      let mapped = null;
      if ((text === 'n' || text === 'N') && mapTilde[text]) mapped = mapTilde[text];
      else if (mapGrave[text]) mapped = mapGrave[text];
      if (mapped){
        io.value = v.slice(0, s-1) + mapped + v.slice(e);
        const caret = (s - 1) + 1; io.selectionStart = io.selectionEnd = caret; io.focus(); return;
      }
    }

    io.value = v.slice(0, s) + text + v.slice(e);
    const caret = s + text.length;
    io.selectionStart = io.selectionEnd = caret;
    io.focus();
  }

  function backspace(){
    const s = io.selectionStart, e = io.selectionEnd, v = io.value;
    if (s !== e){
      io.value = v.slice(0,s) + v.slice(e);
      io.selectionStart = io.selectionEnd = s;
    } else if (s>0){
      io.value = v.slice(0,s-1) + v.slice(e);
      io.selectionStart = io.selectionEnd = s-1;
    }
    io.focus();
  }
  function moveCaret(dx){
    let c = io.selectionStart + dx;
    c = Math.max(0, Math.min(io.value.length, c));
    io.selectionStart = io.selectionEnd = c;
    io.focus();
  }

  function getPrimaryChar(keyEl){
    if (keyEl.classList.contains('space')) return ' ';
    if (keyEl.id === 'enter') return '\n';
    if (keyEl.id === 'shiftL' || keyEl.id === 'shiftR') return '{SHIFT}';
    if (keyEl.classList.contains('bs') || keyEl.textContent.trim().toLowerCase().includes('backspace')) return '{BS}';
    if (keyEl.classList.contains('arrow')){
      const bl = keyEl.querySelector('.mark.BL');
      const tr = keyEl.querySelector('.mark.TR');
      return (shift && tr) ? tr.textContent.trim() : (bl ? bl.textContent.trim() : '');
    }
    const bl = keyEl.querySelector('.mark.BL');
    const tl = keyEl.querySelector('.mark.TL');
    const tr = keyEl.querySelector('.mark.TR');
    const base = (bl?.textContent || tl?.textContent || '').trim();
    const shifted = (tr?.textContent || '').trim();
    if (shift && shifted) return shifted;
    if (/^[A-Z]$/i.test(base)) return shift ? base.toUpperCase() : base.toLowerCase();
    return base;
  }

  document.querySelector('#papillonDemo .board')?.addEventListener('click', (ev)=>{
    // Emoji trigger by explicit key id
    if (ev.target.closest('#emojiKey')) { openEmojiPanel(); return; }
    const key = ev.target.closest('.key');
    if (!key) return;
    const out = getPrimaryChar(key);
    if (out === 'üôÇ'){ openEmojiPanel(); return; }
    if (out === '{SHIFT}'){ shift = !shift; key.classList.toggle('shift-on', shift); return; }
    if (out === '{BS}'){ backspace(); return; }
    if (!out) return;
    insert(out);
    if (emojiOpen && out !== 'üôÇ') closeEmojiPanel();
    if (shift){
      shift = false;
      document.getElementById('shiftL')?.classList.remove('shift-on');
      document.getElementById('shiftR')?.classList.remove('shift-on');
    }
  });

  io.focus();
})();
</script>

;



<script>
</script>
<script>
(function(){
  const btn = document.getElementById('heroBtn');
  const demo = document.getElementById('demo');
  const SEEN = localStorage.getItem('uq_seen_tutorial') === '1';
  if (!btn || !demo) return;
  if (SEEN){
    demo.style.display = 'block';
    document.body.style.overflow = '';
    btn.textContent = 'Essayer maintenant';
    btn.onclick = () => {
      window.scrollTo({ top: demo.offsetTop, behavior: 'smooth' });
    };
  } else {
    btn.onclick = openModal;
  }
})();
</script>
</body>
</html>
